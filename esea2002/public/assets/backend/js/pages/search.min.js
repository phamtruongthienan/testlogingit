var app=app||{},arrayTypeName="",schoolName="";app.init=function(){$("#name").select2({tags:!0,tokenSeparators:[","," "],placeholder:{id:"",text:"Từ khóa"}}),$("#typename, #school_id").select2({placeholder:{id:"",text:"Chọn"}}),$("#modal-typePriority").on("shown.bs.modal",function(a){$("#modal-typePriority #typename").val(arrayTypeName).trigger("change.select2")}),$("#modal-school").on("show.bs.modal",function(a){var b=$("#school_id");b.empty();$(this).find(".lang").val();$.ajax({type:"GET",dataType:"json",url:base_admin+"/ajax/school"}).then(function(a){$.map(a.data,function(a){var c=new Option(a.name,a.id,!1,!1);b.append(c)})})}),$("#modal-school").on("shown.bs.modal",function(a){$("#modal-school #school_id").val(schoolName).trigger("change.select2")}),$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"})});var a,b,c=$(".table-dynamic-search").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/search?table=keyword",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1],class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]});$(".modal").on("shown.bs.modal",function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#SearchForm").validator().on("submit",function(a){$("#SearchBtn").button("loading"),$("#SearchForm .table").val("keyword"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#SearchBtn").button("reset"):(a.preventDefault(),app.SearchFormSubmit("#SearchForm",c,"#SearchBtn","#modal-search"))}),$("#TypePriorityForm").validator().on("submit",function(a){$("#TypePriorityBtn").button("loading"),$("#TypePriorityForm .table").val("prioty"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#TypePriorityBtn").button("reset"):(a.preventDefault(),app.SearchFormSubmit("#TypePriorityForm",b,"#TypePriorityBtn","#modal-typePriority"))}),$("#SchoolForm").validator().on("submit",function(b){$("#SchoolBtn").button("loading"),$("#SchoolForm .table").val("school"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#SchoolBtn").button("reset"):(b.preventDefault(),app.SearchFormSubmit("#SchoolForm",a,"#SchoolBtn","#modal-school"))}),$(document).on("click",".table-dynamic-search .table-action-delete",function(a){a.preventDefault();var b=$(this).attr("data-id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal #module").val("keyword"),$("#confirm-delete-modal #table").val("table_dynamic_search"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$(document).on("click",".table-dynamic-typePriority .table-action-delete",function(a){a.preventDefault();var b=$(this).attr("data-id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal #module").val("prioty"),$("#confirm-delete-modal #table").val("table_dynamic_typePriority"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$(document).on("click",".table-dynamic-listSchool .table-action-delete",function(a){a.preventDefault();var b=$(this).attr("data-id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal #module").val("school"),$("#confirm-delete-modal #table").val("table-dynamic-listSchool"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(d){$("#confirm-delete-modal #confirm-delete").button("loading");var e=$("#confirm-delete-modal #id").val(),f=$("#confirm-delete-modal #module").val();switch($("#confirm-delete-modal #table").val()){case"table_dynamic_search":app.DeleteSearch(e,c,f);break;case"table_dynamic_typePriority":app.DeleteSearch(e,b,f);break;default:app.DeleteSearch(e,a,f)}}),$(document).on("click",".table-dynamic-search .table-action-edit, #modal-search .tab_edit_keyword",function(c){c.preventDefault(),$("#SearchForm #name").prop("required",!1),$("#SearchForm").validator("validate"),$("#SearchForm #name").prop("required",!0),$("#SearchForm").validator("update");var d=$(this).attr("data-id"),e=$(this).attr("data-lang");$("#SearchForm .addTypePriority").attr("data-id",d),$("#SearchForm .btnAddSchool").attr("data-id",d),$("#SearchForm .addTypePriority").attr("data-lang",e),$("#SearchForm .btnAddSchool").attr("data-lang",e),app.ClearFormSearch("#modal-search",e,"edit"),app.UpdateKeyWord(d,e),$.fn.DataTable.isDataTable(".table-dynamic-typePriority")&&$(".table-dynamic-typePriority").DataTable().destroy(),b=$(".table-dynamic-typePriority").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/search?table=prioty&keyword_id="+d+"&lang="+e,responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"type"},{data:"name"},{data:"status"},{data:"action"}],columnDefs:[{width:"150px",targets:[-1],ordering:!1,class:"text-center"},{width:"200px",targets:[2],class:"text-center"},{width:"100px",targets:[0,-2],class:"text-center"}]}),$.fn.DataTable.isDataTable(".table-dynamic-listSchool")&&$(".table-dynamic-listSchool").DataTable().destroy(),a=$(".table-dynamic-listSchool").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/search?table=school&keyword_id="+d+"&lang="+e,responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"school"},{data:"sort"},{data:"status"},{data:"action"}],columnDefs:[{width:"150px",targets:[-1],ordering:!1,class:"text-center"},{width:"100px",targets:[0,-2,2],class:"text-center"}]})}),$(document).on("click",".table-dynamic-typePriority .table-action-edit, #modal-typePriority .tab_edit_keyword_prioty",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormSearch("#modal-typePriority",c,"edit"),app.UpdateKeyWordPriority(b,c)}),$(document).on("click",".table-dynamic-listSchool .table-action-edit",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormSearch("#modal-school",c,"edit"),app.UpdateKeyWordSchool(b,c)}),$(document).on("click","#addSearch",function(a){a.preventDefault(),$("#SearchForm")[0].reset(),$("#name").trigger("change.select2"),$("#name").val([]);var b=$(this).attr("data-lang");app.ClearFormSearch("#modal-search",b,"add"),$("#modal-search .tab_edit_keyword").attr("data-id","null"),$("#modal-search").modal("show")}),$(document).on("click",".addTypePriority",function(a){a.preventDefault(),$("#TypePriorityForm")[0].reset(),arrayTypeName="";var b=$(this).attr("data-lang"),c=$(this).attr("data-id");$("#modal-typePriority #type").val("").trigger("change.select2"),$("#modal-typePriority .keyword_id").val(c),app.ClearFormSearch("#modal-typePriority",b,"add"),$("#modal-typePriority .tab_edit_keyword_prioty").attr("data-id","null"),$("#modal-typePriority").modal("show")}),$(document).on("click",".btnAddSchool",function(a){a.preventDefault(),$("#SchoolForm")[0].reset(),schoolName="";var b=$(this).attr("data-lang"),c=$(this).attr("data-id");$("#modal-school .keyword_id").val(c),app.ClearFormSearch("#modal-school",b,"add"),$("#modal-school .tab_edit_keyword_school").attr("data-id","null"),$("#modal-school").modal("show")}),$(document).on("click","#SearchBtn",function(a){a.preventDefault(),$("#SearchForm").submit()}),$(document).on("click","#TypePriorityBtn",function(a){a.preventDefault(),$("#TypePriorityForm").submit()}),$(document).on("click","#SchoolBtn",function(a){a.preventDefault(),$("#SchoolForm").submit()}),$("#type").select2({placeholder:{id:"",text:"Chọn loại ưu tiên"},allowClear:!0}).on("select2:select",function(a){var b=a.params.data;app.switchFunction(b.id)}),$("#type").on("select2:unselect",function(a){$("#typename").empty()})},app.switchFunction=function(a){var b=$("#typename");switch(b.empty(),a){case"1":$.ajax({type:"GET",dataType:"json",url:base_admin+"/ajax/place?table=district"}).then(function(a){$.map(a.data,function(a){var c=new Option(a.name,a.id,!1,!1);b.append(c)})});break;case"2":$.ajax({type:"GET",dataType:"json",url:base_admin+"/ajax/type"}).then(function(a){$.map(a.data,function(a){var c=new Option(a.name,a.id,!1,!1);b.append(c)})});break;default:$.ajax({type:"GET",dataType:"json",url:base_admin+"/ajax/level"}).then(function(a){$.map(a.data,function(a){var c=new Option(a.name,a.id,!1,!1);b.append(c)})})}},app.ClearFormSearch=function(a,b,c){if("add"==c){switch($(a+" .modal-body > .nav-tabs-custom > .nav-tabs").hide(),a){case"#modal-search":$(a+" .ttlModal").html("Thêm tìm kiếm mới");break;case"#modal-typePriority":$(a+" .ttlModal").html("Thêm loại ưu tiên");break;default:$(a+" .ttlModal").html("Thêm trường vào danh sách tìm kiếm")}$(a+" .action").val("insert"),$(a+" .tab-content .nav-tabs-custom").hide()}else{switch(a){case"#modal-search":$(a+" .modal-body > .nav-tabs-custom > .nav-tabs").show(),$(a+" .ttlModal").html("Cập nhật tìm kiếm"),$(a+" .tab-content .nav-tabs-custom").show();break;case"#modal-typePriority":$(a+" .modal-body > .nav-tabs-custom > .nav-tabs").hide(),$(a+" .ttlModal").html("Cập nhật loại ưu tiên"),$(a+" .tab-content .nav-tabs-custom").hide();break;default:$(a+" .modal-body > .nav-tabs-custom > .nav-tabs").hide(),$(a+" .ttlModal").html("Cập nhật trường trong danh sách tìm kiếm"),$(a+" .tab-content .nav-tabs-custom").hide()}$(a+" .action").val("update")}$(a+" .modal-body > .nav-tabs-custom > ul > li").removeClass("active"),$(a+' a[class*="tab_edit_"][data-lang='+b+"]").parent().addClass("active"),$(a+" .lang").val(b)},app.UpdateKeyWord=function(a,b){$.ajax({url:base_admin+"/ajax/search?table=keyword&lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mKeywordTranslationsAll&&$.each(a.data.mKeywordTranslationsAll,function(c,d){if(b==d.language_id&&($("#modal-search .id").val(a.data.id),$("#modal-search .tab_edit_keyword").attr("data-id",a.data.id),$("#modal-search #name").empty(),d.name)){var e=d.name.split(",");$("#modal-search #name").select2({data:e,tags:!0,tokenSeparators:[","," "],placeholder:{id:"",text:"Từ khóa"}}).val(e).trigger("change.select2")}}),$("#modal-search").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.UpdateKeyWordPriority=function(a,b){$.ajax({url:base_admin+"/ajax/search?table=prioty&lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mKeywordPriotyTranslationsAll&&$.each(a.data.mKeywordPriotyTranslationsAll,function(c,d){b==d.language_id&&($("#modal-typePriority .id").val(a.data.id),$("#modal-typePriority .tab_edit_keyword_prioty").attr("data-id",a.data.id),$("#modal-typePriority #type").val(d.type).trigger("change.select2"),app.switchFunction(d.type.toString()),arrayTypeName=d.district_id?d.district_id:d.school_level_id?d.school_level_id:d.school_type_id)}),$("#modal-typePriority").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.UpdateKeyWordSchool=function(a,b){$.ajax({url:base_admin+"/ajax/search?table=school&lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mKeywordSchoolTranslationsAll&&$.each(a.data.mKeywordSchoolTranslationsAll,function(c,d){b==d.language_id&&($("#modal-school .id").val(a.data.id),$("#modal-school .tab_edit_keyword_school").attr("data-id",a.data.id),schoolName=d.school_id,1==d.status?$("#modal-school #status").iCheck("check"):$("#modal-school #status").iCheck("uncheck"),$("#modal-school #sort").val(d.sort))}),$("#modal-school").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.SearchFormSubmit=function(a,b,c,d){$.ajax({url:base_admin+"/ajax/search",type:"post",data:$(a).serialize(),success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0),$(c).button("reset"),$(d).modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"})}})},app.DeleteSearch=function(a,b,c){$.ajax({url:base_admin+"/ajax/search?action=delete&id="+a+"&table="+c,type:"post",success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0)):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")}})},$(function(){app.init()});