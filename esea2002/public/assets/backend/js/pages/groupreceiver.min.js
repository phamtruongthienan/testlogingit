var app=app||{};app.init=function(){$(".modal").on("show.bs.modal",function(a){$('input[type="radio"]').length>0&&$('input[type="radio"]').iCheck({radioClass:"iradio_minimal-blue"}),app.toggleElement($('input[type="radio"]#ckbGroup'),$("#typeGroup, #selectEmail")),app.toggleElement($('input[type="radio"]#ckbImport'),$("#importExcel")),$("#modal-groupreceiver-add #ckbGroup").iCheck("check")}),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()});var a=$(".table-dynamic-groupreceiver").DataTable({processing:!0,ajax:base_admin+"/ajax/group",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"num"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1,-2],class:"text-center",orderable:!1},{width:"100px",targets:[0],class:"text-center"}]});$("#addGroupReceiverForm").validator().on("submit",function(b){$("#addGroupReceiverBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#addGroupReceiverBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-groupreceiver-add").modal("hide"),$("#addGroupReceiverBtn").button("reset"))}),$("#inputEditPosition").select2({placeholder:"Chọn đối tượng",allowClear:!0}).on("select2:select",function(a){var b=$(this).val();$.get("ajax/mailgroup/"+b,function(a){$("#add_email").html(a)})}),$("#inputEditPosition").on("select2:unselect",function(a){$("#add_email").empty()}),$("#add_email").select2({minimumResultsForSearch:-1,placeholder:function(){$(this).data("placeholder")}}),$(document).on("click",".table-action-export",function(a){a.preventDefault();var b=$(this).attr("data-id");window.location=base_admin+"/ajax/export/"+b}),$(document).on("click",".table-action-delete",function(b){b.preventDefault(),app.clearForm("delete"),$("#modal-groupreceiver-add #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),$(document).on("click",".table-action-edit",function(a){a.preventDefault(),app.clearForm("update");var b=$(this).data("id");$("#modal-groupreceiver-add #excel").hide(),$("#modal-groupreceiver-add #inputAddName").prop("required",!1),$("#modal-groupreceiver-add #add_email").prop("required",!1),$("#addGroupReceiverForm").validator("validate"),$("#modal-groupreceiver-add #inputAddName").prop("required",!0),$("#modal-groupreceiver-add #add_email").prop("required",!0),$("#addGroupReceiverForm").validator("update"),$("#modal-groupreceiver-add").modal("show"),$.ajax({url:base_admin+"/ajax/group?id="+b,type:"get",success:function(a){if("200"==a.code){var b=[];$.each(a.data.mGroupEmailUsers,function(a,c){b.push(c.email)}),$("#modal-groupreceiver-add #id").val(a.data.id),$("#modal-groupreceiver-add #inputAddName").val(a.data.name),$("#modal-groupreceiver-add #ckbGroup").iCheck("check"),$("#modal-groupreceiver-add #inputEditPosition").val(a.data.group).trigger("change"),$.get("ajax/mailgroup/"+a.data.group,function(a){$("#add_email").html(a)}).then(function(a){$("#modal-groupreceiver-add #add_email").val(b).trigger("change")}),$("#modal-groupreceiver-add").modal("show")}else $("#error-modal").modal("show")},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})}),app.submitForm=function(a){var b=new FormData($("#addGroupReceiverForm")[0]);$.ajax({url:base_admin+"/ajax/group",data:b,cache:!1,contentType:!1,enctype:"multipart/form-data",processData:!1,dataType:"json",type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#addGroupReceiverBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),$("#confirm-delete-modal").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},$(document).on("click","#addGroupReceiver",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-groupreceiver-add #excel").show(),$("#modal-groupreceiver-add").modal("show")}),$(document).on("click","#addGroupReceiverBtn",function(a){a.preventDefault(),$("#addGroupReceiverForm").submit()})},app.toggleElement=function(a,b){a.on("ifChanged",function(){$("#modal-groupreceiver-add #inputEditPosition").val("").trigger("change"),$("#modal-groupreceiver-add #add_email").val([]).trigger("change"),$("#modal-groupreceiver-add #attachment").val("");var a=$(this).is(":checked"),c=$(this).prop("id");if(a){switch(b.removeClass("hidden"),c){case"ckbGroup":$("#addGroupReceiverForm #inputEditPosition").prop("required",!0),$("#addGroupReceiverForm #add_email").prop("required",!0);break;default:$("#addGroupReceiverForm #attachment").prop("required",!0)}$("#addGroupReceiverForm").validator("update")}else{switch(b.addClass("hidden"),c){case"ckbGroup":$("#addGroupReceiverForm #inputEditPosition").prop("required",!1),$("#addGroupReceiverForm #add_email").prop("required",!1);break;default:$("#addGroupReceiverForm #attachment").prop("required",!1)}$("#addGroupReceiverForm").validator("validate")}})},app.clearForm=function(a){$("#modal-groupreceiver-add #id").val(""),$("#modal-groupreceiver-add #inputAddName").val(""),$("#modal-groupreceiver-add #inputEditPosition").val("").trigger("change"),$("#modal-groupreceiver-add #ckbGroup").iCheck("uncheck"),$("#modal-groupreceiver-add #ckbImport").iCheck("uncheck"),$("#modal-groupreceiver-add #add_email").val([]).trigger("change"),$("#modal-groupreceiver-add #attachment").val(""),$("#modal-groupreceiver-add #action").val(a)},$(function(){app.init()});