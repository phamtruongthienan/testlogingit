var app=app||{};app.init=function(){$(".select2").select2(),$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$("[data-mask]").inputmask(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()});var a=$(".table-dynamic-account").DataTable({processing:!0,ajax:base_admin+"/ajax/email",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"smtp_server"},{data:"smtp_port"},{data:"smtp_username"},{data:"smtp_protocol"},{data:"smtp_name"},{data:"default"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[3,4,5],class:"text-center"},{width:"100px",targets:[0,2,-2],class:"text-center"}]}),b=$(".table-dynamic-email").DataTable({processing:!0,ajax:base_admin+"/ajax/emailStatus",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"title"},{data:"content"},{data:"group"},{data:"created_at"},{data:"status"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[3,4,5],class:"text-center"},{width:"100px",targets:[0],class:"text-center"},{width:"300px",targets:[2]}]});$("#editAccountForm").validator().on("submit",function(b){$("#editAccountBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#editAccountBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-account-edit").modal("hide"),$("#editAccountBtn").button("reset"))}),$("#sendForm").validator().on("submit",function(a){$("#send-mail").button("loading"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#send-mail").button("reset"):(a.preventDefault(),app.submitForm1(b),$("#send-mail-form").modal("hide"),$("#send-mail").button("reset"))}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/email",data:$("#editAccountForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#editAccountBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),$("#confirm-delete-modal").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.submitForm1=function(a){$.ajax({url:base_admin+"/ajax/emailStatus",data:$("#sendForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),$("#confirm-delete-modal").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},$(document).on("click",".table-action-delete",function(b){b.preventDefault(),$("#modal-account-edit #id").val($(this).data("id"));$(this).attr("data-lang");app.clearForm("delete");$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),$(document).on("click",".mail-status-delete",function(a){a.preventDefault(),$("#send-mail-form #id").val($(this).data("id")),app.clearForm("delete");$(this);$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(a){app.submitForm1(b)})}),$("#modal-account-edit").on("blur","#inputEditPassWord",function(){$(this).val()&&($(this).parents(".form-group").next().find("#inputEditrePassWord").prop("required",!0),$("#editAccountForm").validator("update"))}),$(document).on("click",".table-action-edit",function(a){a.preventDefault(),app.clearForm("update"),$("#modal-account-edit #ttlModal").html(" Cập nhật thông tin account"),$("#modal-account-edit .defaultBtn").show();var b=$(this).data("id");$("#modal-account-edit #inputEditSMTP").prop("required",!1),$("#modal-account-edit #inputEditPassWord").prop("required",!1),$("#modal-account-edit #inputEditrePassWord").prop("required",!1),$("#modal-account-edit #inputEditPort").prop("required",!1),$("#modal-account-edit #inputEditUserName").prop("required",!1),$("#modal-account-edit #inputEditProtocal").prop("required",!1),$("#modal-account-edit #inputEditSender").prop("required",!1),$("#sendForm").validator("validate"),$("#modal-account-edit #inputEditSMTP").prop("required",!0),$("#modal-account-edit #inputEditPort").prop("required",!0),$("#modal-account-edit #inputEditUserName").prop("required",!0),$("#modal-account-edit #inputEditProtocal").prop("required",!0),$("#modal-account-edit #inputEditSender").prop("required",!0),$("#sendForm").validator("update"),$.ajax({url:base_admin+"/ajax/email?id="+b,type:"get",success:function(a){"200"==a.code?($("#modal-account-edit #id").val(a.data[0].id),$("#modal-account-edit #inputEditSMTP").val(a.data[0].smtp_server),$("#modal-account-edit #inputEditPort").val(a.data[0].smtp_port),$("#modal-account-edit #inputEditUserName").val(a.data[0].smtp_username),$("#modal-account-edit #inputEditProtocal").val(a.data[0].smtp_protocol),$("#modal-account-edit #inputEditSender").val(a.data[0].smtp_name),1==a.data[0].default?$("#modal-account-edit #default").iCheck("check"):$("#modal-account-edit #default").iCheck("uncheck"),$("#modal-account-edit").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})}),$(document).on("click","#addAccount",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-account-edit #inputEditSMTP").prop("required",!1),$("#modal-account-edit #inputEditPassWord").prop("required",!1),$("#modal-account-edit #inputEditrePassWord").prop("required",!1),$("#modal-account-edit #inputEditPort").prop("required",!1),$("#modal-account-edit #inputEditUserName").prop("required",!1),$("#modal-account-edit #inputEditProtocal").prop("required",!1),$("#modal-account-edit #inputEditSender").prop("required",!1),$("#sendForm").validator("validate"),$("#modal-account-edit #inputEditSMTP").prop("required",!0),$("#modal-account-edit #inputEditPassWord").prop("required",!0),$("#modal-account-edit #inputEditrePassWord").prop("required",!0),$("#modal-account-edit #inputEditPort").prop("required",!0),$("#modal-account-edit #inputEditUserName").prop("required",!0),$("#modal-account-edit #inputEditProtocal").prop("required",!0),$("#modal-account-edit #inputEditSender").prop("required",!0),$("#sendForm").validator("update"),$("#modal-account-edit .defaultBtn").hide(),$("#modal-account-edit #ttlModal").html(" Tạo mới account"),$("#modal-account-edit").modal("show")}),$(document).on("change","#inputAddType",function(a){var b=$(this).val();$.get("ajax/groupmail/"+b,function(a){$("#add_email").html(a)})}),$(document).on("click","#send-mail",function(a){a.preventDefault(),$("#send-mail-form #action").val("insert"),$("#sendForm").submit()}),$(document).on("click","#editAccountBtn",function(a){a.preventDefault(),$("#editAccountForm").submit()}),$(document).on("click","#SelectAllBtn",function(a){a.preventDefault(),$(".select-email > option").prop("selected","selected"),$(".select-email").trigger("change")}),$(document).on("click","#UnselectAllBtn",function(a){a.preventDefault(),$(".select-email").val(null).trigger("change")})},app.clearForm=function(a){$("#editAccountForm")[0].reset(),$("#modal-account-edit #action").val(a),$("#send-mail-form #action").val(a),$("#modal-account-edit #default").iCheck("update")},$(function(){app.init()});