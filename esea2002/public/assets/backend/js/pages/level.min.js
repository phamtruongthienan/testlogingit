var app=app||{};app.init=function(){$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()});var a=$(".table-dynamic-level").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/level",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1],orderable:!1,class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]});$("#LevelForm").validator().on("submit",function(b){$("#LevelBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#LevelBtn").button("reset"):(b.preventDefault(),app.LevelFormSubmit(a))}),$(document).on("click",".table-action-delete",function(a){a.preventDefault();var b=$(this).data("id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(b){$("#confirm-delete-modal #confirm-delete").button("loading");var c=$("#confirm-delete-modal #id").val();app.DeleteLevel(c,a)}),$(document).on("click",".table-action-edit, #modal-level .tab_edit_level",function(a){a.preventDefault(),$("#LevelForm #name").prop("required",!1),$("#LevelForm").validator("validate"),$("#LevelForm #name").prop("required",!0),$("#LevelForm").validator("update");var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormLevel(c,"edit"),app.UpdateLevel(b,c)}),$(document).on("click","#addLevel",function(a){a.preventDefault(),$("#LevelForm")[0].reset();var b=$(this).attr("data-lang");app.ClearFormLevel(b,"add"),$("#modal-level .tab_edit_course").attr("data-id","null"),$("#modal-level").modal("show")}),$(document).on("click","#LevelBtn",function(a){a.preventDefault(),$("#LevelForm").submit()})},app.ClearFormLevel=function(a,b){"add"==b?($("#modal-level .nav-tabs").hide(),$("#modal-level #ttlModal").html("Thêm cấp bậc trường mới"),$("#modal-level #action").val("insert")):($("#modal-level .nav-tabs").show(),$("#modal-level #ttlModal").html("Cập nhật cấp bậc trường"),$("#modal-level #action").val("update")),$("#modal-level ul > li").removeClass("active"),$("#modal-level .tab_edit_level[data-lang="+a+"]").parent().addClass("active"),$("#modal-level #lang").val(a),$("#modal-level #name").val("")},app.LevelFormSubmit=function(a){$.ajax({url:base_admin+"/ajax/level",type:"post",data:$("#LevelForm").serialize(),success:function(b){"200"==b.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),a.ajax.reload(null,!0),$("#LevelBtn").button("reset"),$("#modal-level").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"})}})},app.UpdateLevel=function(a,b){$.ajax({url:base_admin+"/ajax/level?lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mSchoolLevelTranslationsAll&&$.each(a.data.mSchoolLevelTranslationsAll,function(c,d){b==d.language_id&&($("#modal-level #id").val(a.data.id),$("#modal-level .tab_edit_level").attr("data-id",a.data.id),$("#modal-level #name").val(d.name))}),$("#modal-level").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.DeleteLevel=function(a,b){$.ajax({url:base_admin+"/ajax/level?action=delete&id="+a,type:"post",success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0)):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")}})},$(function(){app.init()});