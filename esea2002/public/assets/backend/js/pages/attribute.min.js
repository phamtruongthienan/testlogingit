var app=app||{};app.init=function(){function a(a){var b=a.element;return $('<span><i class="'+$(b).attr("value")+'"></i> '+$(b).attr("value")+"</span>")}$("#ckbAttribute").hide(),$(".select2").select2(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"})});var b=$(".table-dynamic-groupAttribute").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/attribute?table=attributegroup",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"group"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1],orderable:!1,class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]}),c=$(".table-dynamic-attribute").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/attribute",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"group"},{data:"value"},{data:"unit"},{data:"active"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1,2,3,-2],class:"text-center"},{width:"100px",targets:[0,-2],class:"text-center"},{targets:[-1],orderable:!1}]});$("#GroupAttributeForm").validator().on("submit",function(a){$("#GroupAttributeBtn").button("loading"),$("#GroupAttributeForm .table").val("attributegroup"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#GroupAttributeBtn").button("reset"):(a.preventDefault(),app.AttributeFormSubmit("#GroupAttributeForm",b,"#GroupAttributeBtn","#modal-groupAttribute"))}),$("#AttributeForm").validator().on("submit",function(a){$("#AttributeBtn").button("loading"),$("#AttributeForm .table").val("attribute"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#AttributeBtn").button("reset"):(a.preventDefault(),app.AttributeFormSubmit("#AttributeForm",c,"#AttributeBtn","#modal-attribute"))}),$(document).on("click",".table-dynamic-groupAttribute .table-action-delete",function(a){a.preventDefault();var b=$(this).attr("data-id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal #module").val("attributegroup"),$("#confirm-delete-modal #table").val("table_dynamic_groupAttribute"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$(document).on("click",".table-dynamic-attribute .table-action-delete",function(a){a.preventDefault();var b=$(this).attr("data-id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal #module").val("attribute"),$("#confirm-delete-modal #table").val("table_dynamic_attribute"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(a){$("#confirm-delete-modal #confirm-delete").button("loading");var d=$("#confirm-delete-modal #id").val(),e=$("#confirm-delete-modal #module").val();switch($("#confirm-delete-modal #table").val()){case"table_dynamic_attribute":app.DeleteAttribute(d,c,e);break;default:app.DeleteAttribute(d,b,e)}}),$(document).on("click",".table-dynamic-attribute .table-action-edit, #modal-attribute .tab_edit_attribute",function(a){a.preventDefault(),$("#AttributeForm .name").prop("required",!1),$("#AttributeForm").validator("validate"),$("#AttributeForm .name").prop("required",!0),$("#AttributeForm").validator("update");var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormAttribute("#AttributeForm","#modal-attribute",c,"edit"),app.UpdateAttribute(b,c)}),$(document).on("click",".table-dynamic-groupAttribute .table-action-edit, #modal-groupAttribute .tab_edit_group_attribute",function(a){a.preventDefault(),$("#GroupAttributeForm .name").prop("required",!1),$("#GroupAttributeForm").validator("validate"),$("#GroupAttributeForm .name").prop("required",!0),$("#GroupAttributeForm").validator("update");var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormAttribute("#GroupAttributeForm","#modal-groupAttribute",c,"edit"),app.UpdateAttributeGroup(b,c)}),$(document).on("click","#addGroupAttribute",function(a){a.preventDefault();var b=$(this).attr("data-lang");app.ClearFormAttribute("#GroupAttributeForm","#modal-groupAttribute",b,"add")}),$(document).on("click","#addAttribute",function(a){a.preventDefault();var b=$(this).attr("data-lang");app.ClearFormAttribute("#AttributeForm","#modal-attribute",b,"add")}),$(document).on("click","#GroupAttributeBtn",function(a){a.preventDefault(),$("#GroupAttributeForm").submit()}),$(document).on("click","#AttributeBtn",function(a){a.preventDefault(),$("#AttributeForm").submit()}),app.changeSelect($("#type"),$("#inputAttribute"),$("#ckbAttribute")),$.ajax({type:"GET",dataType:"json",url:base_admin+"/ajax/attribute?table=attributegroup"}).then(function(a){$.map(a.data,function(a){var b=new Option(a.group,a.id,!1,!1);$("#school_category_id").append(b)})}),$("#icon").select2({templateSelection:a,templateResult:a,allowHtml:!0})},app.changeSelect=function(a,b,c){a.on("change",function(a){"1"==$(this).val()?(c.hide(),b.show(),$("#AttributeForm #value").prop("required",!0),$("#AttributeForm").validator("update")):($("#AttributeForm #value").prop("required",!1),$("#AttributeForm").validator("validate"),c.show(),b.hide())})},app.ClearFormAttribute=function(a,b,c,d){if($(a)[0].reset(),"add"==d){switch($(b+" .nav-tabs").hide(),b){case"#modal-groupAttribute":$(b+" .ttlModal").html("Thêm nhóm thuộc tính mới");break;default:$(b+" .ttlModal").html("Thêm thuộc tính mới")}$(b+" .action").val("insert")}else switch($(b+" .nav-tabs").show(),$(b+" .action").val("update"),b){case"#modal-groupAttribute":$(b+" .ttlModal").html("Cập nhật nhóm thuộc tính");break;default:$(b+" .ttlModal").html("Cập nhật thuộc tính")}$(b).modal("show"),$(b+" ul > li").removeClass("active"),$(b+" .lang").val(c),$(b+' [class*="tab_edit_"][data-lang='+c+"]").parent().addClass("active")},app.AttributeFormSubmit=function(a,b,c,d){$.ajax({url:base_admin+"/ajax/attribute",type:"post",data:$(a).serialize(),success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0),$(c).button("reset"),$(d).modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"})}})},app.UpdateAttributeGroup=function(a,b){$.ajax({url:base_admin+"/ajax/attribute?table=attributegroup&lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mSchoolCategoryTranslationsAll&&$.each(a.data.mSchoolCategoryTranslationsAll,function(c,d){b==d.language_id&&($("#modal-groupAttribute .id").val(a.data.id),$("#modal-groupAttribute .tab_edit_group_attribute").attr("data-id",a.data.id),$("#modal-groupAttribute .name").val(d.name))}),$("#modal-groupAttribute").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.UpdateAttribute=function(a,b){$.ajax({url:base_admin+"/ajax/attribute?table=attribute&lang="+b+"&id="+a,type:"get",success:function(a){"200"==a.code?(void 0!==a.data.mSchoolAttributeTranslationsAll&&$.each(a.data.mSchoolAttributeTranslationsAll,function(c,d){b==d.language_id&&($("#modal-attribute .id").val(a.data.id),$("#modal-attribute .tab_edit_attribute").attr("data-id",a.data.id),$("#modal-attribute .name").val(d.name),$("#modal-attribute #school_category_id").val(a.data.mSchoolCategory.id).trigger("change.select2"),$("#modal-attribute #type").val(a.data.type).trigger("change.select2"),1==a.data.type?($("#modal-attribute #unit").val(d.unit).trigger("change.select2"),$("#modal-attribute #value").val(d.content),$("#ckbAttribute").hide(),$("#inputAttribute").show(),$("#AttributeForm #value").prop("required",!0),$("#AttributeForm").validator("update")):($("#ckbAttribute").show(),$("#inputAttribute").hide(),$("#AttributeForm #value").prop("required",!1),$("#AttributeForm").validator("validate"),1==d.content?$("#modal-attribute #ckbvalue").iCheck("check"):$("#modal-attribute #ckbvalue").iCheck("uncheck")),$("#modal-attribute #icon").val(a.data.icon).trigger("change.select2"),1==a.data.search?$("#modal-attribute #search").iCheck("check"):$("#modal-attribute #search").iCheck("uncheck"))}),$("#modal-attribute").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.DeleteAttribute=function(a,b,c){$.ajax({url:base_admin+"/ajax/attribute?action=delete&id="+a+"&table="+c,type:"post",success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0)):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")}})},$(function(){app.init()});