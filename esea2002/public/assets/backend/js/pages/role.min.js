var app=app||{};app.init=function(){$(".select2").select2({placeholder:"Chọn quyền"}),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$.fn.validator.Constructor.INPUT_SELECTOR=':input:not([type="submit"], button):enabled';var a=$(".table-dynamic-role").DataTable({processing:!0,ajax:base_admin+"/ajax/role",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"display_name"},{data:"description"},{data:"action"}],columnDefs:[{targets:[2],class:"text-center"},{targets:[3],class:"text-center"},{width:"200px",targets:[-1,1],class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]});$(document).on("click",".table-action-delete",function(b){b.preventDefault(),app.clearForm("delete"),$("#modal-role-edit #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),$(document).on("click",".table-dynamic-role .table-action-edit",function(a){a.preventDefault(),app.clearForm("update"),$("#modal-role-edit #ttlModal").html("Cập nhật quyền"),$("#modal-role-edit #inputEditNameDisplay").prop("required",!1),$("#modal-role-edit #edit_description").prop("required",!1),$("#editRoleForm").validator("validate"),$("#modal-role-edit #inputEditNameDisplay").prop("required",!0),$("#modal-role-edit #edit_description").prop("required",!0),$("#editRoleForm").validator("update");var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/role?id="+b,type:"get",success:function(a){if("200"==a.code){var b=[];$.each(a.data.permissions,function(a,c){b.push(c.id)}),$("#modal-role-edit #id").val(a.data.id),$("#modal-role-edit #edit_permission").val(b).trigger("change"),$("#modal-role-edit #inputEditNameDisplay").val(a.data.display_name),$("#modal-role-edit #inputEditName").html(a.data.name),$("#modal-role-edit #edit_description").val(a.data.description),$("#modal-role-edit").modal("show")}else Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})}),$(document).on("click","#addRole",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-role-edit #ttlModal").html("Thêm quyền mới"),$("#modal-role-edit").modal("show")}),$(document).on("click","#editRoleBtn",function(a){a.preventDefault(),$("#editRoleForm").submit()}),$(document).on("click","#SelectAllBtn",function(a){a.preventDefault(),$(".select-permission > option").prop("selected","selected"),$(".select-permission").trigger("change")}),$(document).on("click","#UnselectAllBtn",function(a){a.preventDefault(),$(".select-permission").val([]).trigger("change.select2")}),$(document).on("click","#SelectAllBtnEdit",function(a){a.preventDefault(),$(".select-permission-edit > option").prop("selected","selected"),$(".select-permission-edit").trigger("change")}),$(document).on("click","#UnselectAllBtnEdit",function(a){a.preventDefault(),$(".select-permission-edit").val(null).trigger("change")}),$("#editRoleForm").validator().on("submit",function(b){$("#editRoleBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#editRoleBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-role-edit").modal("hide"),$("#editRoleBtn").button("reset"))}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/role",data:$("#editRoleForm").serialize(),type:"POST",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#editRoleBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),$("#confirm-delete-modal").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.clearForm=function(a){$("#modal-role-edit #action").val(a),$("#modal-role-edit #id").val(""),$("#modal-role-edit #inputEditName").html(""),$("#modal-role-edit #edit_description").val(""),$("#modal-role-edit #inputEditNameDisplay").val(""),$("#modal-role-edit #edit_permission").val([]).trigger("change")}},$(function(){app.init()});