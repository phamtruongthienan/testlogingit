var app=app||{};app.init=function(){$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$(".select2").select2(),app.toggleElement($('input[type="radio"]#inputEditLink'),$("#ckbEditLink"),$("#ckbEditSelect"),$("#editMenuForm")),app.toggleElement($('input[type="radio"]#inputEditSelect'),$("#ckbEditSelect"),$("#ckbEditLink"),$("#editMenuForm"))}),$("#ckbSelect, #ckbEditSelect").hide(),$("#ckbEditLink, #ckbEditLink").hide();var a=$(".table-dynamic-menu").DataTable({processing:!0,ajax:base_admin+"/ajax/menu",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"position"},{data:"url"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1,2,3]},{width:"100px",targets:[0],class:"text-center"}]});$("#editMenuForm").validator().on("submit",function(b){$("#editMenuBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#editMenuBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-menu-edit").modal("hide"),$("#editMenuBtn").button("reset"))}),app.submitForm=function(b){$.ajax({url:base_admin+"/ajax/menu",data:$("#editMenuForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#editMenuBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},$(document).on("click",".table-action-edit, #modal-menu-edit .tab_edit_menu",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormNews(c,"update"),app.UpdateNews(b,c)}),app.ClearFormNews=function(a,b){"insert"==b?($("#modal-menu-edit .nav-tabs").hide(),$("#modal-menu-edit #ttlModal").html(" Thêm cấp menu mới"),$("#modal-menu-edit #action").val(b)):($("#modal-menu-edit .nav-tabs").show(),$("#modal-menu-edit #ttlModal").html(" Cập nhật Menu"),$("#modal-menu-edit #action").val(b)),$("#modal-menu-edit ul > li").removeClass("active"),$("#modal-menu-edit .tab_edit_menu[data-lang="+a+"]").parent().addClass("active"),$("#modal-menu-edit #lang").val(a)},app.UpdateNews=function(a,b){$("#modal-menu-edit #inputEditName").prop("required",!1),$("#modal-menu-edit inputLink").prop("checked")?$("#modal-menu-edit #inputAddLink").prop("required",!1):$("#modal-menu-edit #inputAddSelect").prop("required",!1),$("#modal-menu-edit").validator("validate"),$("#modal-menu-edit #inputEditName").prop("required",!0),$("#modal-menu-edit inputLink").prop("checked")?$("#modal-menu-edit #inputAddLink").prop("required",!0):$("#modal-menu-edit #inputAddSelect").prop("required",!0),$("#modal-menu-edit").validator("update"),$.ajax({url:base_admin+"/ajax/menu?id="+a,type:"get",success:function(c){"200"==c.code?($("#modal-menu-edit .tab_edit_menu").attr("data-id",a),null==c.data[0].news_id?($("#modal-menu-edit #inputEditLink").iCheck("check"),$("#ckbEditLink, #ckbEditLink").show(),$("#ckbSelect, #ckbEditSelect").hide()):($("#modal-menu-edit #inputEditSelect").iCheck("check"),$("#ckbSelect, #ckbEditSelect").show(),$("#ckbEditLink, #ckbEditLink").hide()),$("#modal-menu-edit #inputEditPosition").val(c.data[0].position).trigger("change"),$("#modal-menu-edit #inputEditSelectNews").val(c.data[0].news_id).trigger("change"),"undefined"!==c.data[0].mMenuTranslationsAll&&$.each(c.data[0].mMenuTranslationsAll,function(a,c){b==c.language_id&&($("#modal-menu-edit #id").val(c.id),$("#modal-menu-edit #inputEditName").val(c.name),$("#modal-menu-edit #inputEditLink").val(c.slug))}),$("#modal-menu-edit").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})}})},$(document).on("click",".table-action-delete",function(b){b.preventDefault(),$("#modal-menu-edit #id").val($(this).data("id"));var c=$(this).attr("data-lang");app.ClearFormNews(c,"delete");$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),$(document).on("click","#addMenu",function(a){a.preventDefault();var b=$(this).attr("data-lang");$("#editMenuForm")[0].reset(),$("#modal-menu-edit #inputEditLink").iCheck("check"),$("#ckbEditLink, #ckbEditLink").show(),app.ClearFormNews(b,"insert"),$("#modal-menu-edit").modal("show")}),$(document).on("click","#editMenuBtn",function(a){a.preventDefault(),$("#editMenuForm").submit()})},app.toggleElement=function(a,b,c,d){a.on("ifChecked",function(){b.show(),c.hide(),c.children(":first").prop("required",!1),d.validator("validate"),b.children(":first").prop("required",!0),d.validator("update")})},$(function(){app.init()});