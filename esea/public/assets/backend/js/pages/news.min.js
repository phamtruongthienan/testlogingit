var app=app||{};app.init=function(){app.changeUrl($("#inputEditName"),$("#inputEditSEO")),app.changeUrl($("#inputEditSEO"),$("#inputEditSEO")),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$(".select2").select2()});var a=$(".table-dynamic-news").DataTable({processing:!0,ajax:base_admin+"/ajax/news",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"title"},{data:"layout"},{data:"active"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"200px",targets:[-1,2]},{width:"100px",targets:[0,-2],class:"text-center"}]});$("#editNewsForm").validator().on("submit",function(b){$("#editNewsBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#editNewsBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-news-edit").modal("hide"),$("#editNewsBtn").button("reset"))}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/news",data:$("#editNewsForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#editNewsBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})}})},$(document).on("click",".table-action-delete",function(b){b.preventDefault(),$("#modal-news-edit #id").val($(this).data("id"));var c=$(this).attr("data-lang");app.ClearFormNews(c,"delete");$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),$(document).on("click",".table-action-edit, #modal-news-edit .tab_edit_news",function(a){a.preventDefault();var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormNews(c,"update"),app.UpdateNews(b,c)}),app.ClearFormNews=function(a,b){"insert"==b?($("#modal-news-edit .nav-tabs").hide(),$("#modal-news-edit #ttlModal").html(" Thêm cấp tin tức mới"),$("#modal-news-edit #action").val(b)):($("#modal-news-edit .nav-tabs").show(),$("#modal-news-edit #ttlModal").html(" Cập nhật tin tức"),$("#modal-news-edit #action").val(b)),$("#modal-news-edit ul > li").removeClass("active"),$("#modal-news-edit .tab_edit_news[data-lang="+a+"]").parent().addClass("active"),$("#modal-news-edit #lang").val(a)},app.UpdateNews=function(a,b){$("#modal-news-edit #inputEditName").prop("required",!1),$("#modal-news-edit #inputEditSEO").prop("required",!1),$("#modal-news-edit #inputTitle").prop("required",!1),$("#modal-news-edit #inputKeyWord").prop("required",!1),$("#modal-news-edit #inputDescription").prop("required",!1),$("#modal-news-edit").validator("validate"),$("#modal-news-edit #inputEditName").prop("required",!0),$("#modal-news-edit #inputEditSEO").prop("required",!0),$("#modal-news-edit #inputTitle").prop("required",!0),$("#modal-news-edit #inputKeyWord").prop("required",!0),$("#modal-news-edit #inputDescription").prop("required",!1),$("#modal-news-editr").validator("update"),$.ajax({url:base_admin+"/ajax/news?id="+a,type:"get",success:function(c){"200"==c.code?($("#modal-news-edit .tab_edit_news").attr("data-id",a),1==c.data[0].status?$("#modal-news-edit #editStatus").iCheck("check"):$("#modal-news-edit #editStatus").iCheck("uncheck"),$("#modal-news-edit #inputEditLayout").val(c.data[0].mLayout.id).trigger("change"),"undefined"!==c.data[0].mNewsTranslationsAll&&$.each(c.data[0].mNewsTranslationsAll,function(a,c){b==c.language_id&&($("#modal-news-edit #id").val(c.id),$("#modal-news-edit #inputEditName").val(c.title),$("#modal-news-edit #inputEditSEO").val(c.slug),$("#modal-news-edit #inputTitle").val(c.meta_title),$("#modal-news-edit #inputKeyWord").val(c.meta_keyword),$("#modal-news-edit #inputDescription").val(c.meta_keyword),$("#modal-news-edit #inputEditContent").summernote("code",c.content))}),$("#modal-news-edit").modal("show")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi xảy ra"})}})},$(document).on("click","#addNews",function(a){a.preventDefault();var b=$(this).attr("data-lang");$("#editNewsForm")[0].reset(),$("#modal-news-edit #inputEditContent").summernote("code",""),app.ClearFormNews(b,"insert"),$("#modal-news-edit").modal("show")}),$(document).on("click","#editNewsBtn",function(a){a.preventDefault(),$("#editNewsForm").submit()})},app.xoa_dau=function(a){return a=a.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a"),a=a.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e"),a=a.replace(/ì|í|ị|ỉ|ĩ/g,"i"),a=a.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o"),a=a.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u"),a=a.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y"),a=a.replace(/đ/g,"d")},app.string_to_slug=function(a){return a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase(),a=app.xoa_dau(a),a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},app.changeUrl=function(a,b){a.keyup(function(){var a=$(this).val(),c=app.string_to_slug(a);b.val(c)})},$(function(){app.init()});