var app=app||{};app.init=function(){$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()});var a=$(".table-dynamic-room").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/room",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"position"},{data:"action"}],columnDefs:[{width:"200px",targets:[-1],orderable:!1,class:"text-center"},{width:"300px",targets:[-2],class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]});$("#RoomForm").validator().on("submit",function(b){$("#RoomBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#RoomBtn").button("reset"):(b.preventDefault(),app.RoomFormSubmit(a))}),$(document).on("click",".table-action-delete",function(a){a.preventDefault();var b=$(this).data("id");$("#confirm-delete-modal #id").val(b),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(b){$("#confirm-delete-modal #confirm-delete").button("loading");var c=$("#confirm-delete-modal #id").val();app.DeleteRoom(c,a)}),$(document).on("click",".table-action-edit, #modal-room .tab_edit_room",function(a){a.preventDefault(),$("#RoomForm #name").prop("required",!1),$("#RoomForm #position").prop("required",!1),$("#RoomForm").validator("validate"),$("#RoomForm #name").prop("required",!0),$("#RoomForm #position").prop("required",!0),$("#RoomForm").validator("update");var b=$(this).attr("data-id"),c=$(this).attr("data-lang");app.ClearFormRoom(c,"edit"),app.UpdateRoom(b,c)}),$(document).on("click","#addRoom",function(a){a.preventDefault();var b=$(".addOption .form-group:not(:last)");$.each(b,function(a,b){b.remove()});var c=$(".addOption .form-group");c.find(".idaddon").attr("value",""),c.find(".nameaddon").attr("value",""),c.find(".contentaddon").attr("value","");var d=$(this).attr("data-lang");app.ClearFormRoom(d,"add"),$("#modal-room .tab_edit_room").attr("data-id","null"),$("#modal-room").modal("show")}),$(document).on("click","#RoomBtn",function(a){a.preventDefault(),$("#RoomForm").submit()}),$(document).on("click",".addElement",function(a){var b=$(this).parents(".form-group").clone();b.find(".idaddon").attr("value",""),b.find(".nameaddon").attr("value",""),b.find(".contentaddon").attr("value","");var c=$(this).parents(".addOption");c.append('<div class="form-group">'+$(b).html()+"</div>"),c.find(".form-group:not(:last) .addElement").removeClass("addElement").addClass("removeElement"),c.find(".form-group .removeElement").removeClass("fa-plus").addClass("fa-minus")}),$(document).on("click",".removeElement",function(a){$(this).parents(".form-group").remove()}),$(".addOption").find(".form-group:not(:last) .addElement").removeClass("addElement").addClass("removeElement"),$(".addOption").find(".form-group .removeElement").removeClass("fa-plus").addClass("fa-minus"),$("#modal-room").on("blur",".nameaddon",function(){$(this).val()?($(this).parent().next().find(".contentaddon").prop("required",!0),$("#RoomForm").validator("update")):($(this).parent().next().find(".contentaddon").prop("required",!1),$("#RoomForm").validator("update"))})},app.ClearFormRoom=function(a,b){"add"==b?($("#modal-room .nav-tabs").hide(),$("#modal-room #ttlModal").html("Thêm phòng học mới"),$("#modal-room #action").val("insert")):($("#modal-room .nav-tabs").show(),$("#modal-room #ttlModal").html("Cập nhật phòng học"),$("#modal-room #action").val("update")),$("#modal-room ul > li").removeClass("active"),$("#modal-room .tab_edit_room[data-lang="+a+"]").parent().addClass("active"),$("#modal-room #lang").val(a),$("#RoomForm")[0].reset()},app.RoomFormSubmit=function(a){$.ajax({url:base_admin+"/ajax/room",type:"post",data:$("#RoomForm").serialize(),success:function(b){"200"==b.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg}),a.ajax.reload(null,!0),$("#RoomBtn").button("reset"),$("#modal-room").modal("hide")):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:b.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"})}})},app.UpdateRoom=function(a,b){$.ajax({url:base_admin+"/ajax/room?lang="+b+"&id="+a,type:"get",success:function(a){if("200"==a.code){void 0!==a.data.mSchoolClassTranslationsAll&&$.each(a.data.mSchoolClassTranslationsAll,function(c,d){b==d.language_id&&($("#modal-room #id").val(a.data.id),$("#modal-room .tab_edit_room").attr("data-id",a.data.id),$("#modal-room #name").val(d.name),$("#modal-room #position").val(d.position))});var c=$(".addOption .form-group:not(:last)");$.each(c,function(a,b){b.remove()});var d=$(".addOption .form-group");if(d.find(".idaddon").attr("value",""),d.find(".nameaddon").attr("value",""),d.find(".contentaddon").attr("value",""),d.find(".contentaddon").prop("required",!1),$("#RoomForm").validator("update"),void 0!==a.data.mSchoolClassAddons&&a.data.mSchoolClassAddons.length>0){var e=$(".addOption .form-group").clone();$.each(a.data.mSchoolClassAddons.reverse(),function(a,c){e.find(".idaddon").attr("value",c.id),void 0!==c.mSchoolClassAddonTranslationsAll&&$.each(c.mSchoolClassAddonTranslationsAll,function(a,c){b==c.language_id&&(e.find(".nameaddon").attr("value",c.name),e.find(".contentaddon").attr("value",c.content))}),$(".addOption").prepend('<div class="form-group">'+e.html()+"</div>")})}$(".addOption").find(".form-group:not(:last) .addElement").removeClass("addElement").addClass("removeElement"),$(".addOption").find(".form-group:last .removeElement").removeClass("removeElement").addClass("addElement"),$(".addOption").find(".form-group .removeElement").removeClass("fa-plus").addClass("fa-minus"),$(".addOption").find(".form-group .addElement").removeClass("fa-minus").addClass("fa-plus"),$("#modal-room").modal("show")}else Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg})},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:response.msg})}})},app.DeleteRoom=function(a,b){$.ajax({url:base_admin+"/ajax/room?action=delete&id="+a,type:"post",success:function(a){"200"==a.code?(Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),b.ajax.reload(null,!0)):Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:a.msg}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")},error:function(a,b,c){Lobibox.notify("warning",{title:"Thông báo",pauseDelayOnHover:!0,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Có lỗi trong quá trình xử lý"}),$("#confirm-delete-modal #confirm-delete").button("reset"),$("#confirm-delete-modal").modal("hide")}})},$(function(){app.init()});