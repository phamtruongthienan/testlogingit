var app=app||{};app.init=function(){$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$(".select2").select2({placeholder:"Chọn vị trí",allowClear:!0})}),$("[data-mask]").inputmask(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#activity-log-modal").on("shown.bs.modal",function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(document).on("click",".table-action-delete",function(b){b.preventDefault(),app.clearForm("delete"),$("#modal-employee #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})});var a=$(".table-dynamic-employee").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/employee",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"email"},{data:"name"},{data:"dob"},{data:"phone"},{data:"locked"},{data:"role"},{data:null}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[3,4,5,6],class:"text-center"},{width:"100px",targets:[0,2],class:"text-center"},{width:"200px",orderable:!1,targets:[-1],class:"text-center",render:function(a,b,c,d){return'<a class="table-action table-action-edit text-green cursor-pointer" data-id="'+a.id+'"><i class="fa fa-edit"></i></a> <a class="table-action text-red table-action-delete cursor-pointer" data-id="'+a.id+'"><i class="fa fa-trash"></i></a> <a class="table-action text-aqua table-action-view cursor-pointer" data-id="'+a.id+'"><i class="fa fa-eye"></i></a>'}}]});$(document).on("click",".table-action-view",function(a){a.preventDefault();var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/employee?id="+b,type:"get",success:function(a){if("200"==a.code){var b;$.each(a.data.activity,function(a,c){b+="<tr><td>"+c.id+"</td><td>"+c.created_at+"</td><td>"+c.description+"<td></tr>"}),$("#activity").html(b),$("#activity-log-modal").modal("show")}else $("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click",".table-action-edit",function(a){a.preventDefault(),app.clearForm("update");var b=$(this).data("id");$("#modal-employee #inputEditName").prop("required",!1),$("#modal-employee #inputEditBirthday").prop("required",!1),$("#modal-employee #inputEditPhone").prop("required",!1),$("#modal-employee").validator("validate"),$("modal-employee #inputEditName").prop("required",!0),$("#modal-employee #inputEditBirthday").prop("required",!0),$("#modal-employee #inputEditPhone").prop("required",!0),$("#modal-employee").validator("update"),$.ajax({url:base_admin+"/ajax/employee?id="+b,type:"get",success:function(a){"200"==a.code?($("#modal-employee #id").val(a.data.user.id),$("#modal-employee #inputEditUserName").val(a.data.user.email),$("#modal-employee #inputEditName").val(a.data.user.name),$("#modal-employee #inputEditBirthday").val(a.data.user.dob),$("#modal-employee #inputEditPhone").val(a.data.user.phone),$("#modal-employee #inputEditPosition").val(a.data.user.role_users[0].role_id).trigger("change"),console.log(a.data.user.role_users[0].role_id),1==a.data.user.locked?$("#modal-employee #status").iCheck("check"):$("#modal-employee #status").iCheck("uncheck"),$("#modal-employee").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/employee",data:$("#editEmployeeForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#EmployeeBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},$(document).on("click","#EmployeeBtn",function(a){a.preventDefault(),$("#editEmployeeForm").submit()}),$(document).on("click","#addEmployee",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-employee").modal("show")}),$("#editEmployeeForm").validator().on("submit",function(b){$("#EmployeeBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#EmployeeBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-employee").modal("hide"),$("#EmployeeBtn").button("reset"))}),app.clearForm=function(a){$("#editEmployeeForm")[0].reset(),$("#modal-employee #action").val(a)}},$(function(){app.init()});