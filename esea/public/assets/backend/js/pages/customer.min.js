var app=app||{},table_dynamic_child,email="";app.init=function(){function a(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}}$(".modal").on("show.bs.modal",function(a){$('input[type="radio"], input[type="checkbox"]').length>0&&$('input[type="radio"], input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$("#inputAddChildGentive").select2({placeholder:"Chọn tính cách",allowClear:!0,maximumSelectionLength:4})}),$("[data-mask]").inputmask(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$("#list-child-modal").on("shown.bs.modal",function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(" #modal-customer, #modalChild").on("show.bs.modal",function(a){$('input[type="radio"]').length>0&&$('input[type="radio"]').iCheck({radioClass:"iradio_minimal-blue"})});var b=$(".table-dynamic-customer").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/customer",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"phone"},{data:"email"},{data:"type"},{data:"status"},{data:null}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[2,3,5],class:"text-center"},{width:"100px",targets:[0,4],class:"text-center"},{width:"200px",targets:[-1],orderable:!1,class:"text-center",render:function(a,b,c,d){return'<a class="table-action table-action-edit text-green cursor-pointer" data-id="'+a.id+'"><i class="fa fa-edit"></i></a> <a class="table-action text-red table-action-delete cursor-pointer" data-id="'+a.id+'"><i class="fa fa-trash"></i></a> <a class="table-action text-aqua table-action-view cursor-pointer" data-id="'+a.id+'"><i class="fa fa-eye"></i></a>'}}]});$(document).on("click",".table-action-edit",function(a){a.preventDefault(),app.clearForm("update");var b=$(this).data("id");$("#modal-customer #inputEditName").prop("required",!1),$("#modal-customer #inputEditPhone").prop("required",!1),$("#modal-customer #sexMale").prop("required",!1),$("#modal-customer #sexFemale").prop("required",!1),$("#modal-customer").validator("validate"),$("#modal-customer #inputEditName").prop("required",!0),$("#modal-customer #inputEditPhone").prop("required",!0),$("#modal-customer #sexMale").prop("required",!0),$("#modal-customer #sexFemale").prop("required",!0),$("#modal-customer").validator("update"),$.ajax({url:base_admin+"/ajax/customer?id="+b,type:"get",success:function(a){"200"==a.code?($("#modal-customer #id").val(a.data.id),$("#modal-customer #inputEditEmail").val(a.data.email),$("#modal-customer #inputEditName").val(a.data.name),$("#modal-customer #inputEditPhone").val(a.data.phone),1==a.data.gender?$("#modal-customer #sexMale").prop("checked",!0):0==a.data.gender?$("#modal-customer #sexFemale").prop("checked",!0):$("#modal-customer #sexDif").prop("checked",!0),1==a.data.status?$("#modal-customer #status").iCheck("check"):$("#modal-customer #status").iCheck("uncheck"),$("#modal-customer").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})});var c=a("email");void 0!=c&&$(".table-dynamic-customer").DataTable().search(c).draw(),$(document).on("click","#CustomerBtn",function(a){a.preventDefault(),$("#editCustomerForm").submit()}),$("#editCustomerForm").validator().on("submit",function(a){$("#CustomerBtn").button("loading"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#CustomerBtn").button("reset"):(a.preventDefault(),app.submitForm(b),$("#modal-customer").modal("hide"),$("#CustomerBtn").button("reset"))}),$(document).on("click",".table-action-delete",function(a){a.preventDefault(),app.clearForm("delete"),$("#modal-customer #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(a){app.submitForm(b)})}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/customer",data:$("#editCustomerForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#CustomerBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},app.submitForm1=function(a){$.ajax({url:base_admin+"/ajax/child",data:$("#editChildForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#editChildBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},$(document).on("click",".table-action-view",function(a){a.preventDefault();var b=$(this).data("id");$.fn.DataTable.isDataTable(".table-dynamic-child")&&($(".table-dynamic-child").DataTable().destroy(),$(".table-dynamic-child tbody").empty()),table_dynamic_child=$(".table-dynamic-child").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/child?parent="+b,responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"name"},{data:"gender"},{data:"dob"},{data:"genitive"},{data:"school"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[2,3],class:"text-center"},{width:"200px",targets:[4,5],class:"text-center"},{width:"100px",targets:[0],class:"text-center"}]}),$("#list-child-modal").modal("show")}),$(document).on("click",".table-action-edit-child",function(a){a.preventDefault(),app.clearForm("update");var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/child?id="+b,type:"get",success:function(a){if("200"==a.code){var c=a.data.genitive,d=c.split(",");$("#modalChild #id").val(b),$("#modalChild #inputChildName").val(a.data.name),$("#modalChild #inputEditChildBirthday").val(a.data.dob),$("#modalChild #inputAddChildGentive").val(d).trigger("change"),1==a.data.gender?$("#modalChild #sexChildMale").prop("checked",!0):0==a.data.gender&&$("#modalChild #sexChildFemale").prop("checked",!0),$("#modalChild").modal("show")}else $("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click","#editChildBtn",function(a){a.preventDefault(),$("#modalChild").submit()}),$("#modalChild").validator().on("submit",function(a){$("#editChildBtn").button("loading"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#editChildBtn").button("reset"):(a.preventDefault(),app.submitForm1(table_dynamic_child),$("#modalChild").modal("hide"),$("#editChildBtn").button("reset"))}),$(document).on("click",".table-action-delete-child",function(a){a.preventDefault(),app.clearForm("delete"),$("#modalChild #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(a){app.submitForm1(table_dynamic_child)})}),$(document).on("click","#addCustomer",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-customer").modal("show")}),app.clearForm=function(a){$("#modal-customer #action").val(a),$("#editChildForm #action").val(a),$("#modal-customer #id").val(""),$("#modal-customer #inputEditEmail").val(""),$("#modal-customer #inputEditPassWord").val(""),$("#modal-customer #inputEditRePassWord").val(""),$("#modal-customer #inputEditName").val(""),$("#modal-customer #sexDif").prop("checked",!1),$("#modal-customer #sexMale").prop("checked",!1),$("#modal-customer #sexFemale").prop("checked",!1),$("#modal-customer #inputEditPhone").val(""),$("#modal-customer #status").iCheck("uncheck"),$("#modalChild #sexChildMale").prop("checked",!1),$("#modalChild #sexChildFemale").prop("checked",!1),$("#modalChild #inputChildName").val(""),$("#modalChild #inputEditChildBirthday").val(""),$("#modalChild #inputAddChildGentive").val([]).trigger("change")}},$(function(){app.init()});