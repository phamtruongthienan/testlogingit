var app=app||{};app.init=function(){var a,b;$(".select2").select2(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),$(document).on("show.bs.tab",'a[href="#tab_district"]',function(b){a.ajax.reload(null,!0)}),$(document).on("show.bs.tab",'a[href="#tab_ward"]',function(a){b.ajax.reload(null,!0)});var c=$(".table-dynamic-place").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/place",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,order:[[0,"desc"]],columns:[{data:"id"},{data:"name"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"100px",targets:[0],class:"text-center"},{width:"200px",targets:[-1],orderable:!1,class:"text-center"}]});$("#addCityForm").validator().on("submit",function(a){$("#addCityBtn").button("loading"),$("#addCityForm .table").val("city"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#addCityBtn").button("reset"):(a.preventDefault(),app.submitForm("#listPlace",c,"#addCityForm","#addCityBtn"),$("#modal-city-add").modal("hide"),$("#addCityBtn").button("reset"))}),$("#editCityForm").validator().on("submit",function(a){$("#editCityBtn").button("loading"),$("#editCityForm .table").val("city"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#editCityBtn").button("reset"):(a.preventDefault(),app.submitForm("#listPlace",c,"#editCityForm","#editCityBtn"),$("#modal-city-edit").modal("hide"),$("#editCityBtn").button("reset"))}),$("#DistrictForm").validator().on("submit",function(b){$("#DistrictBtn").button("loading"),$("#DistrictForm .table").val("district"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#DistrictBtn").button("reset"):(b.preventDefault(),app.submitForm("#tab_district",a,"#DistrictForm","#DistrictBtn"),$("#modal-district").modal("hide"),$("#DistrictBtn").button("reset"))}),$("#WardForm").validator().on("submit",function(a){$("#WardBtn").button("loading"),$("#WardForm .table").val("ward"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#WardBtn").button("reset"):(a.preventDefault(),app.submitForm("#tab_ward",b,"#WardForm","#WardBtn"),$("#modal-ward").modal("hide"),$("#WardBtn").button("reset"))}),$(document).on("click",".table-dynamic-place .table-action-delete",function(a){a.preventDefault(),app.clearForm("#editCityForm","delete"),$("#editCityForm .id").val($(this).data("id")),$("#editCityForm .table").val("city"),$("#confirm-delete-modal #module").val("city"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$(document).on("click",".table-dynamic-district .table-action-delete",function(a){a.preventDefault(),app.clearForm("#DistrictForm","delete"),$("#DistrictForm .id").val($(this).data("id")),$("#DistrictForm .table").val("district"),$("#confirm-delete-modal #module").val("district"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$(document).on("click",".table-dynamic-ward .table-action-delete",function(a){a.preventDefault(),app.clearForm("#WardForm","delete"),$("#WardForm .id").val($(this).data("id")),$("#WardForm .table").val("ward"),$("#confirm-delete-modal #module").val("ward"),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(d){switch($("#confirm-delete-modal #module").val()){case"city":app.submitForm("#listPlace",c,"#editCityForm","#editCityBtn");break;case"district":app.submitForm("#tab_district",a,"#DistrictForm","#DistrictBtn");break;default:app.submitForm("#tab_ward",b,"#WardForm","#WardBtn")}$("#confirm-delete-modal").modal("hide")}),$(document).on("click",".table-dynamic-place .table-action-edit",function(c){c.preventDefault(),app.clearForm("#editCityForm","update");var d=$(this).data("id");$("#city_id").val(d),$.ajax({url:base_admin+"/ajax/place?id="+d+"&type=detail",type:"get",success:function(a){"200"==a.code?($("#editCityForm .id").val(a.data.id),$("#editCityForm .name").val(a.data.name),$("#modal-city-edit").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}}),a=$(".table-dynamic-district").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/place?id="+d+"&type=district",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,destroy:!0,columns:[{data:"id"},{data:"name"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"100px",targets:[0],class:"text-center"},{width:"200px",targets:[-1],orderable:!1,class:"text-center"}]}),b=$(".table-dynamic-ward").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/place?id="+d+"&type=ward",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,destroy:!0,columns:[{data:"id"},{data:"district"},{data:"name"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"300px",targets:[2],class:"text-center"},{width:"100px",targets:[0],class:"text-center"},{width:"200px",targets:[-1],orderable:!1,class:"text-center"}]}),$("#district_id").select2({placeholder:"Chọn quận/huyện",allowClear:!0,delay:250,ajax:{url:base_admin+"/ajax/place?id="+d+"&type=district",dataType:"json",type:"GET",processResults:function(a){return{results:$.map(a.data,function(a){return{text:a.name,id:a.id}})}}}})}),$(document).on("click","#addCity",function(a){$("#addCityForm")[0].reset(),a.preventDefault(),app.clearForm("#modal-city-add","insert"),$("#modal-city-add").modal("show")}),$(document).on("click","#addDistrict",function(a){$("#DistrictForm")[0].reset(),$("#DistrictForm .table").val("district"),$("#modal-district .ttlModal").html("Thêm quận mới"),a.preventDefault(),app.clearForm("#modal-district","insert"),$("#modal-district").modal("show")}),$(document).on("click","#addWard",function(a){$("#WardForm")[0].reset(),$("#modal-ward .ttlModal").html("Thêm phường mới"),a.preventDefault(),app.clearForm("#modal-ward","insert"),$("#modal-ward").modal("show"),$("#WardForm #district_id").empty()}),$(document).on("click",".table-dynamic-district .table-action-edit",function(a){$("#DistrictForm .name").prop("required",!1),$("#DistrictForm").validator("validate"),$("#DistrictForm .name").prop("required",!0),$("#DistrictForm").validator("update"),$("#modal-district .ttlModal").html("Cập nhật quận"),a.preventDefault(),app.clearForm("#DistrictForm","update");var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/place?id="+b+"&table=district",type:"get",success:function(a){"200"==a.code?($("#DistrictForm .id").val(a.data.id),$("#DistrictForm .name").val(a.data.name),$("#modal-district").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}}),$("#modal-district").modal("show")}),$(document).on("click",".table-dynamic-ward .table-action-edit",function(a){$("#WardForm .name").prop("required",!1),$("#WardForm").validator("validate"),$("#WardForm .name").prop("required",!0),$("#WardForm").validator("update"),$("#modal-ward .ttlModal").html("Cập nhật phường"),a.preventDefault(),app.clearForm("#WardForm","update");var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/place?id="+b+"&table=ward",type:"get",success:function(a){"200"==a.code?($("#WardForm .id").val(a.data.id),$("#WardForm .name").val(a.data.name),$("#WardForm #district_id").select2("trigger","select",{data:{id:a.data.district_id,text:a.data.configDistrict.name}}),$("#modal-ward").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}}),$("#modal-ward").modal("show")}),$(document).on("click","#addCityBtn",function(a){a.preventDefault(),$("#addCityForm").submit()}),$(document).on("click","#editCityBtn",function(a){a.preventDefault(),$("#editCityForm").submit()}),$(document).on("click","#DistrictBtn",function(a){a.preventDefault(),$("#DistrictForm").submit()}),$(document).on("click","#WardBtn",function(a){a.preventDefault(),$("#WardForm").submit()})},app.submitForm=function(a,b,c,d){$.ajax({url:base_admin+"/ajax/place",data:$(c).serialize(),type:"post",success:function(c){"200"==c.code?(b.ajax.reload(null,!0),$(a+" > #error_msg").hide(),$(a+" > .row #alert_msg").removeClass("no-display").find("span").html(c.msg),$(d).button("reset")):$(a+" > #error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+c.msg).show()},error:function(b,c,d){$(a+" > #error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},app.clearForm=function(a,b){$(a+" .action").val(b),$(a+" .id").val(""),$(a+" .name").val("")},$(function(){app.init()});