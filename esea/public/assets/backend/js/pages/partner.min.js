var app=app||{},table_dynamic_partner;app.init=function(){changeImage("#logoImage",'input[id="logo"]',"#PartnerForm"),$("[data-mask]").inputmask(),$(".select2").select2(),$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(a){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}),autocompleteSchool(".single-select2",base_admin+"/ajax/client/school"),$("#modal-client").on("show.bs.modal",function(a){$('input[type="checkbox"]').length>0&&$('input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal-blue"})}),table_dynamic_partner=$(".table-dynamic-partner").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/client",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,order:[[6,"desc"]],columns:[{data:"id"},{data:"name"},{data:"address"},{data:"email"},{data:"phone"},{data:"status"},{data:"sort"},{data:"action"}],columnDefs:[{targets:[1],class:"text-ellipsis"},{width:"150px",targets:[3,4,5,6],class:"text-center"},{width:"100px",targets:[0],class:"text-center"},{width:"300px",targets:[2],class:"text-ellipsis"},{width:"200px",targets:[-1],class:"text-center"}],drawCallback:function(){$(".table-dynamic-partner tr:nth-child(1) .upBtn").remove(),$(".table-dynamic-partner tr:last .downBtn").remove(),$(".upBtn").unbind("click"),$(".downBtn").unbind("click"),$(".upBtn").on("click",function(){app.moveUp($(this))}),$(".downBtn").on("click",function(){app.moveDown($(this))})}}),$("#PartnerForm").validator().on("submit",function(a){$("#PartnerBtn").button("loading"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#PartnerBtn").button("reset"):(a.preventDefault(),app.submitForm(table_dynamic_partner),$("#modal-client").modal("hide"),$("#PartnerBtn").button("reset"))}),$(document).on("click",".table-action-delete",function(a){a.preventDefault(),app.clearForm("delete"),$("#modal-client #id").val($(this).data("id")),$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1})}),$("#confirm-delete-modal").on("click","#confirm-delete",function(a){app.submitForm(table_dynamic_partner),$("#confirm-delete-modal").modal("hide")}),$(document).on("click",".table-dynamic-partner .table-action-edit",function(a){$("#ttlModal").html("Cập nhật đối tác mới"),a.preventDefault(),app.clearForm("update");var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/client?id="+b,type:"get",success:function(a){"200"==a.code?($("#modal-client #id").val(a.data.id),$("#modal-client #name").val(a.data.mClientTranslations[0].name),$("#modal-client #address").val(a.data.mClientTranslations[0].address),$("#modal-client #email").val(a.data.mClientTranslations[0].email),$("#modal-client #phone").val(a.data.mClientTranslations[0].phone),$("#modal-client #fax").val(a.data.mClientTranslations[0].fax),$("#modal-client #website").val(a.data.mClientTranslations[0].website),$("#modal-client #school_name").val(a.data.mClientTranslations[0].mSchool.mSchoolTranslations[0].name),$("#modal-client #school_id").val(a.data.id),$("#modal-client #job").val(a.data.mClientTranslations[0].job),$("#modal-client #content").summernote("code",a.data.mClientTranslations[0].content),$("#modal-client #investment").val(a.data.mClientTranslations[0].investment),$("#modal-client #staff").val(a.data.mClientTranslations[0].staff),null!=a.data.mClientTranslations[0].logo&&$("#modal-client #logoImage").attr("src",base_url+"/img/"+a.data.mClientTranslations[0].logo),1==a.data.status?$("#modal-client #status").iCheck("check"):$("#modal-client #status").iCheck("uncheck"),$("#modal-client").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click","#addPartner",function(a){$("#ttlModal").html("Thêm đối tác mới"),a.preventDefault(),app.clearForm("insert"),$("#modal-client").modal("show")}),$(document).on("click","#PartnerBtn",function(a){a.preventDefault(),$("#PartnerForm").submit()})},app.moveUp=function(a){var b=a.data("id"),c=a.parents("tr");$.ajax({url:base_admin+"/ajax/client?action=update&up=1&id="+b,type:"post",success:function(a){app.moveRow(c,"up"),table_dynamic_partner.ajax.reload(null,!1)},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},app.moveDown=function(a){var b=a.data("id"),c=a.parents("tr");$.ajax({url:base_admin+"/ajax/client?action=update&down=1&id="+b,type:"post",success:function(a){app.moveRow(c,"down"),table_dynamic_partner.ajax.reload(null,!1)},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},app.moveRow=function(a,b){var c=table_dynamic_partner.row(a).index(),d=-1;"down"===b&&(d=1);var e=table_dynamic_partner.row(c).data();e.sort+=d;var f=table_dynamic_partner.row(c+d).data();f.sort+=-d,table_dynamic_partner.row(c).data(f),table_dynamic_partner.row(c+d).data(e),table_dynamic_partner.draw(!1)},app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/client",data:$("#PartnerForm").serialize(),type:"post",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#error_msg").hide(),$("#alert_msg").removeClass("no-display").find("span").html(b.msg),$("#PartnerBtn").button("reset")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},app.clearForm=function(a){$("#modal-client #action").val(a),$("#modal-client #id").val(""),$("#modal-client #name").val(""),$("#modal-client #address").val(""),$("#modal-client #email").val(""),$("#modal-client #phone").val(""),$("#modal-client #fax").val(""),$("#modal-client #website").val(""),$("#modal-client #school_name").val(""),$("#modal-client #school_id").val(""),$("#modal-client #job").val(""),$("#modal-client #content").summernote("code",""),$("#modal-client #investment").val(""),$("#modal-client #staff").val(""),$("#modal-client #logoImage").attr("src",base_url+"/assets/backend/img/no_image.png"),$("#modal-client #image_hash").val(""),$("#modal-client #status").iCheck("uncheck")},$(function(){app.init()});