var app=app||{},dateBooking="";app.init=function(){$("[data-mask]").inputmask(),$("#inputEditSchool").select2({placeholder:"Chọn",allowClear:!0}),$('input[name="inputBook"]').daterangepicker({singleDatePicker:!0,timePicker:!0,minYear:1901,maxYear:parseInt(moment().format("YYYY"),10),timePicker24Hour:!0,locale:{format:"YYYY-MM-DD hh:mm:ss"}});var a=$(".table-dynamic-visiter").DataTable({processing:!0,serverSide:!0,ajax:base_admin+"/ajax/visiter",responsive:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,info:!0,autoWidth:!0,scrollX:!0,scrollCollapse:!0,columns:[{data:"id"},{data:"datebook"},{data:"school"},{data:"datevisit"},{data:"customer"},{data:"phone"},{data:"email"},{data:"status"},{data:"action"}],columnDefs:[{targets:[2],class:"text-ellipsis"},{width:"150px",targets:[1,3,5,6,7],class:"text-center"},{width:"200px",targets:[4]},{width:"100px",targets:[0],class:"text-center"}]});$("#addVisiterForm").validator().on("submit",function(a){$("#addVisiterBtn").button("loading"),$(".alert").addClass("no-display"),a.isDefaultPrevented()?$("#addVisiterBtn").button("reset"):(a.preventDefault(),setTimeout(function(){$("#alert_visiter_msg").removeClass("no-display"),$("#addVisiterBtn").button("reset"),setTimeout(function(){$(".alert").addClass("no-display")},3e3)},1e3))}),$(document).on("click",".table-action-delete",function(a){a.preventDefault();var b=$(this),c=$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(a){c.row(b.parents("tr")).remove().draw()})}),$(document).on("click",".table-action-edit",function(a){a.preventDefault();var b=$(this).data("id");$("#modal-visiter-edit #inputEditSchool").prop("required",!1),$("#modal-visiter-edit #inputBook").prop("required",!1),$("#modal-visiter-edit #inputEditName").prop("required",!1),$("#modal-visiter-edit #inputEditPhone").prop("required",!1),$("#modal-visiter-edit #inputEditEmail").prop("required",!1),$("#modal-visiter-edit #inputEditStatus").prop("required",!1),$("#modal-visiter-edit").validator("validate"),$("#modal-visiter-edit #inputEditSchool").prop("required",!0),$("#modal-visiter-edit #inputBook").prop("required",!0),$("#modal-visiter-edit #inputEditName").prop("required",!0),$("#modal-visiter-edit #inputEditPhone").prop("required",!0),$("#modal-visiter-edit #inputEditEmail").prop("required",!0),$("#modal-visiter-edit #inputEditStatus").prop("required",!0),$("#modal-visiter-edit").validator("update"),app.clearForm("update"),$("#modal-visiter-edit #dateBooking").show(),$.ajax({url:base_admin+"/ajax/visiter?id="+b,type:"get",success:function(a){"200"==a.code?($("#modal-visiter-edit #id").val(b),$("#modal-visiter-edit #inputEditBook").html(a.data.created_at),$("#modal-visiter-edit #inputEditName").val(a.data.name),$("#modal-visiter-edit #inputBook").val(a.data.booking_date),$("#modal-visiter-edit #inputEditPhone").val(a.data.phone),$("#modal-visiter-edit #inputEditEmail").val(a.data.email),$("#modal-visiter-edit #inputEditDesire").summernote("code",a.data.content),$("#modal-visiter-edit #inputEditStatus").val(a.data.status).trigger("change"),$("#modal-visiter-edit #inputEditSchool").val(a.data.school_id).trigger("change"),$("#modal-visiter-edit").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click",".table-action-view",function(a){a.preventDefault();var b=$(this).data("id");app.clearForm("update"),$.ajax({url:base_admin+"/ajax/visiter?id="+b,type:"get",success:function(a){"200"==a.code?($("#note-modal #content").html(a.data.content),$("#note-modal").modal("show")):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click",".table-action-reply",function(a){a.preventDefault();var b=$(this).data("id");$("#modal-visiter-reply #id").val(b),$("#modal-visiter-reply #inputReplyContent").val(""),$("#modal-visiter-reply").modal("show")}),$(document).on("click","#replyVisiterBtn",function(a){a.preventDefault(),$.ajax({url:base_admin+"/ajax/sendFeedback",data:$("#replyVisiterForm").serialize(),type:"POST",success:function(a){"200"==a.code?($("#modal-visiter-reply").modal("hide"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Gửi phản hồi thành công"})):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click","#addVisiter",function(a){a.preventDefault(),app.clearForm("insert"),$("#modal-visiter-edit #dateBooking").hide(),$("#modal-visiter-edit").modal("show")}),$(document).on("click","#editVisiterBtn",function(a){a.preventDefault(),$("#editVisiterForm").submit()}),$(document).on("click",".table-action-visiter-info",function(a){a.preventDefault();var b=$(this).data("id");$.ajax({url:base_admin+"/ajax/visiter?id="+b,type:"get",success:function(a){"200"==a.code?window.location.replace(base_admin+"/customer?email="+a.data.email):$("#error-modal").modal("show")},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})}),$(document).on("click",".table-action-delete",function(b){b.preventDefault(),app.clearForm("delete"),$("#modal-visiter-edit #id").val($(this).data("id"));$(this),$(this).parents("table").DataTable();$("#confirm-delete-modal").modal({backdrop:"static",keyboard:!1}).one("click","#confirm-delete",function(b){app.submitForm(a)})}),app.submitForm=function(a){$.ajax({url:base_admin+"/ajax/visiter",data:$("#editVisiterForm").serialize(),type:"POST",success:function(b){"200"==b.code?(a.ajax.reload(null,!0),$("#alert_msg_edit").removeClass("no-display"),$("#editVisiterBtn").button("reset"),Lobibox.notify("success",{title:"Thông báo",pauseDelayOnHover:!1,continueDelayOnInactiveTab:!1,icon:!1,sound:!1,msg:"Thay đổi thông tin thành công"}),$("#confirm-delete-modal").modal("hide")):$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+b.msg).show()},error:function(a,b,c){$("#error_msg").html('<i class="fas fa-exclamation-triangle"></i> '+response.msg).show()}})},$("#editVisiterForm").validator().on("submit",function(b){$("#editVisiterBtn").button("loading"),$(".alert").addClass("no-display"),b.isDefaultPrevented()?$("#editVisiterBtn").button("reset"):(b.preventDefault(),app.submitForm(a),$("#modal-visiter-edit").modal("hide"),$("#editVisiterBtn").button("reset"))}),app.clearForm=function(a){$("#modal-visiter-edit #action").val(a),$("#modal-visiter-edit #inputEditBook").html(""),$("#modal-visiter-edit #inputBook").val(""),$("#modal-visiter-edit #inputEditName").val(""),$("#modal-visiter-edit #inputEditPhone").val(""),$("#modal-visiter-edit #inputEditEmail").val(""),$("#modal-visiter-edit #inputEditSchool").val(null).trigger("change"),$("#modal-visiter-edit #inputEditStatus").val(null).trigger("change"),$("#modal-visiter-edit #inputEditDesire").summernote("code","")}},$(function(){app.init()});